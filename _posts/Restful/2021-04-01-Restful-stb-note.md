---
layout: post
title: 小项目与Restful规范
categories: [http, https, java]
description: 小项目与Restful规范
keywords: keyword1, keyword2
---

# TBS与Restful规范

> Create by ***Codermawl*** at 2021-04-01

----

***开篇小语***

- 表述性状态转移（Representational State Transfer） --- *Restful*

	```
	REST 是一组架构约束，面向资源；
	
	越简单、越灵活
	
	安全性、幂等性、无状态性
	
	...
	```
	
	*话不多说，直接正题*

## 1、请求分析

- ***通用说明***

	```
	1. URI规范
	  - 不用大写；
	  - 用中杠-不用下杠_；
	  - 参数列表要encode；？？
	  - URI中的名词表示资源集合，使用复数形式
	```

### 1.1、资源查询

- 范围限定

	> 简单数据或属性查询、单体对象查询、列表分页查询
	
- 请求类型

	> GET
	
- URI 定义

	```
	--- 单数查询
	
	1.比如：查询ID为100的peer节点的详细信息
	/peer/{id} [?p0=0]
	
	2.比如：查询用户user的地址信息（聚合查询）
	/user/{id}/address
	
	--- 复数查询
	
	3.比如：查询peer节点列表
	/peers[?p0=0]
	
	4.比如：分页查询peer节点
	/peers/${offset}/${size} [?p0=0]
	
	--- 复合查询
	5.比如：查询区块链的内部详细信息，包括peers、orderers、channels、orgs等多个，以及区块链自己描述性信息，这里以fabric为例
	/blockchain/{id}/peers [?p0=0]
	/blockchain/{id}/orderers [?p0=0]
	/blockchain/{id}/all-members/detail [?p0=0]
	```
	
	***总结（这里的总结全文适用）*** 
	
	```
	1.pathValue传参形式中，变量尽量只使用资源ID；
	2.特殊含义的变量也可以出现在pathValue传参形式中，比如：分页'offset'和'size'；
	3.业务性质的参数尽量放到'?'语句中，这里可以理解为ID具有系统性质；
	4.对于其他可以放到pathValue中的变量，最好能够组内整理出来，目的是控制URI的长度，防止爆炸；
	5.URI中杜绝动词，多用代表性名词，尽量模版化；
	```
	
- 传参形式

	```
	1.pathValue形式
	2.parameter形式
	3.混合形式
	```
	
### 1.2、资源创建

- 范围限定

	> 通用资源的创建、新增、注册等
	
- 请求类型

	> POST
	
- URI 定义

	```
	1.比如：创建peer节点
	/peer
	
	2.比如：创建多个peer节点
	/peers
	```
	
- 传参形式

	```
	统一使用body形式
	```
	
### 1.3、资源修改

- 范围限定

	> 通用资源的修改、更新
	
- 请求类型

	> PUT <br>

	*PATCH 再定*
	
- URI 定义

	```
	1.比如：修改peer节点
	/peer/{id}
	
	2.比如：修改peer节点状态
	/peer/{id}/status/{enum_status}
	```
	
	***总结***
	
	```
	1.pathValue中可以放置的变量，建议是简单、确定的枚举类型；
	2.如果是批量修改，建议用body形式传参；
	```
	
- 传参形式

	```
	1.pathValue形式
	2.body形式
	3.混合形式
	```
	
### 1.4、资源删除

- 范围限定

	> 通用资源的删除
	
- 请求类型

	> DELETE
	
- URI 定义

	```
	1.比如：删除单个peer节点
	/peer/{id}
	
	2.比如：删除多个peer节点
	/peers
	```

- 传参形式

	```
	1.pathValue形式
	2.parameter形式
	```
	
### 1.5、遗留问题

- 文件上传、下载怎么规划？
- 一个操作中包含多个对等资源怎么规划？（场景？）
- 登录、登出、验证？
- 对等资源之间依赖的关系绑定、修改、移除怎么规划？

	```
	初步分析：
	--- 操作类型类
	文件上传：向服务器上传文件，相当于改变了服务器状态 --POST
	文件下载：获取操作 --GET
	登录：告诉服务器我要进入系统，服务器维持登录状态 --POST
	登出：告诉服务器我要退出系统，服务器移除登录状态 --POST
	验证：客户端只需要要一个结果，服务器没有改变状态 --GET
	
	--- 资源归属类
	(1)如果关系被定义为单独的资源
	创建关系 --POST
	修改关系 --PUT
	移除关系 --DELETE
	
	(2)如果关系为附属属性，在当前业务中务必指定一个主体资源，这时候关系的处理就相当于
	资源的修改 --PUT
	```


## 2、响应分析

### 2.1、响应码

- ***！！！不建议自定义响应码！！！*** 项目中建议使用下面罗列的响应码

	```
	--- 可用返回码
	200 OK - [*]：服务器成功返回用户请求的数据，幂等。
	202 Accepted - [*]：请求已经进入后台排队（异步任务）。
	400 INVALID REQUEST - [*]：请求有错误，服务器没有进行新建或修改数据的操作，幂等。
	401 Unauthorized - [*]：用户没有权限（令牌、用户名、密码错误），操作权限控制。
	403 Forbidden - [*] 用户得到授权（与401错误相对），但是访问被禁止，数据权限控制。
	404 NOT FOUND - [*]：资源不存在，服务器没有进行操作，幂等。
	500 INTERNAL SERVER ERROR - [*]：服务器发生错误，用户无法判断发出的请求是否成功。
	503 Service Unavailable - [*]：服务端当前无法处理请求，比如：限流等。
	
	--- 分类说明
	2xx success
	4xx error
	5xx failure
	```

- ***经验之谈***

	```
	我们的项目为什么不建议自定义响应码呢？
	回答：目的是什么？代价是多少？维护性？价值？可读性？美观性？
	
	之前做项目见过有自定义响应码的，多见于银行系统，联通移动公司的大型系统，他们的共同特点是一只交易流水线巨长，网络拓扑复杂，业务系统独立性高，数据隐私那是绝对**...
	说到这里你应该有所感觉了，一旦流说出错，响应码的威力立即体现出来...
	
	一套完备的响应码架构，需要考量的范围很多，对创造它的人要求更高，超强业务总结能力+未知问题分析能力+连锁反应洞察能力+艺术能力+（想不到其他词了），总之不简单
	一般人架构出来的，人见人吐...
	
	再回头看看我们的项目，业务流水短，主业务基本集中在一两个系统中就能完成（就算不是也要往上面靠），其他的辅助吧。
	```

### 2.1、返回数据

```
GET    ：返回资源对象的列表（数组）或单个资源对象
POST   ：返回新生成的资源对象ID
PUT    ：返回一个空文档
DELETE ：返回一个空文档
```
